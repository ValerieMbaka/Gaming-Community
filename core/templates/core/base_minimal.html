{% load static %}

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% block title %} GameHub {% endblock %}</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700&family=Rubik:wght@300;400;500&display=swap" rel="stylesheet">

    <!-- Base CSS -->
    <link rel="stylesheet" href="{% static 'users/css/base_minimal.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/toast.css' %}">
    <!-- Dashboard CSS -->
    {% block dashboard_css %}{% endblock %}
    <!-- Profile CSS -->
    {% block profile_css %}{% endblock %}

    {% block extra_head %}{% endblock %}
</head>
<body>
    <div id="toast-container"></div>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="nav-left">
            <button class="sidebar-toggle-btn" aria-label="Toggle sidebar">
                <i class="fas fa-bars"></i>
            </button>
	        <!-- Back to Home Button -->
	        <a href="{% url 'core:home' %}" class="back-to-home-btn">
		        <i class="fas fa-home"></i>
		        <span>Back to Home</span>
	        </a>
            <!-- Search Bar -->
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search games, communities, competitions...">
            </div>
        </div>

        <div class="nav-right">
            <!-- Dark Mode Toggle -->
            <button class="nav-icon theme-toggle-btn" id="darkModeToggle" aria-label="Toggle dark mode" data-tooltip="Dark Mode">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </button>

            <!-- Notifications Dropdown -->
            <div class="nav-dropdown">
                <button class="nav-icon" title="Notifications" data-tooltip="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-bubble">5</span>
                </button>
                <div class="nav-dropdown-content notifications-dropdown">
                    <div class="dropdown-header">
                        <h4>Notifications</h4>
                        <button class="mark-all-read">Mark all as read</button>
                    </div>
                    <div class="dropdown-list">
                        <div class="notification-item unread">
                            <div class="notification-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="notification-content">
                                <p><strong>Tournament Alert:</strong> Valorant Championship starts in 2 hours</p>
                                <small>45 minutes ago</small>
                            </div>
                        </div>
                        <div class="notification-item unread">
                            <div class="notification-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="notification-content">
                                <p><strong>Community:</strong> 3 new members joined your FIFA Pros group</p>
                                <small>2 hours ago</small>
                            </div>
                        </div>
                    </div>
                    <a href="#" class="dropdown-footer">View All Notifications</a>
                </div>
            </div>

            <!-- User Profile Dropdown -->
            <div class="nav-dropdown profile-dropdown">
                <button class="profile-btn" aria-label="User profile">
                    <img src="{% if request.user.is_authenticated and request.user.profile_picture %}{{ request.user.profile_picture.url }}{% else %}{% static 'core/images/player.jpeg' %}{% endif %}" class="profile-avatar" alt="User Avatar">
                    <span class="username">{% if request.user.is_authenticated %}{% if request.user.custom_username %}{{ request.user.custom_username }}{% elif request.user.first_name %}{{ request.user.first_name }}{% else %}{{ request.user.email|truncatechars:15 }}{% endif %}{% else %}Guest{% endif %}</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="nav-dropdown-content profile-dropdown-content">
                    <div class="profile-header">
                        <img src="{% if request.user.is_authenticated and request.user.profile_picture %}{{ request.user.profile_picture.url }}{% else %}{% static 'core/images/player.jpeg' %}{% endif %}" class="dropdown-avatar" alt="User Avatar">
                        <div class="profile-info">
                            <h4>{% if request.user.is_authenticated %}{% if request.user.custom_username %}{{ request.user.custom_username }}{% elif request.user.first_name %}{{ request.user.first_name }}{% else %}{{ request.user.email|truncatechars:15 }}{% endif %}{% else %}Guest{% endif %}</h4>
                            <small>{% if request.user.is_authenticated %}{{ request.user.bio|default:'Gamer' }}{% else %}Welcome{% endif %}</small>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'users:gamer_dashboard' %}" class="dropdown-item">
                        <i class="fas fa-user"></i> View Profile
                    </a>
                    <a href="{% url 'users:user_settings' %}" class="dropdown-item">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item">
                        <i class="fas fa-moon"></i> Dark Mode
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="{% url 'users:logout' %}" class="dropdown-item">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <!-- Profile Section at Top -->
            <div class="sidebar-profile">
                <img src="{% if request.user.is_authenticated and request.user.profile_picture %}{{ request.user.profile_picture.url }}{% else %}{% static 'core/images/player.jpeg' %}{% endif %}" class="sidebar-avatar" alt="User Avatar">
                <div class="sidebar-profile-info">
                    <h4>{% if request.user.is_authenticated %}{% if request.user.custom_username %}{{ request.user.custom_username }}{% elif request.user.first_name %}{{ request.user.first_name }}{% else %}{{ request.user.email|truncatechars:15 }}{% endif %}{% else %}Guest{% endif %}</h4>
                    <small>{% if request.user.is_authenticated %}{{ request.user.bio|default:'Gamer' }}{% else %}Welcome{% endif %}</small>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="dashboard-nav">
                <!-- Gaming Section -->
                <div class="nav-section">
                    <div class="section-header">
                        <i class="fas fa-gamepad"></i>
                        <span>Gaming</span>
                    </div>
                    <ul class="nav-list">
                        <li>
                            <a href="{% url 'users:gamer_dashboard' %}" class="nav-link active" data-tooltip="Dashboard">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link" data-tooltip="My Games">
                                <i class="fas fa-gamepad"></i>
                                <span>My Games</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-link" data-tooltip="Competitions">
                                <i class="fas fa-trophy"></i>
                                <span>Competitions</span>
                                <span class="badge">2</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Social Section -->
                <div class="nav-section">
                    <div class="section-header">
                        <i class="fas fa-users"></i>
                        <span>Social</span>
                    </div>
                    <ul class="nav-list">
                        <li>
                            <a href="#" class="nav-link" data-tooltip="Feeds">
                                <i class="fas fa-newspaper"></i>
                                <span>Feeds</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'communities:communities_list' %}" class="nav-link" data-tooltip="Communities">
                                <i class="fas fa-users"></i>
                                <span>Communities</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Profile Section -->
                <div class="nav-section">
                    <div class="section-header">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </div>
                    <ul class="nav-list">
                        <li>
                            <a href="#" class="nav-link" data-tooltip="Notifications">
                                <i class="fas fa-bell"></i>
                                <span>Notifications</span>
                                <span class="badge">5</span>
                            </a>
                        </li>
                        <li>
                            <a href="{% url 'users:user_settings' %}" class="nav-link" data-tooltip="Settings">
                                <i class="fas fa-cog"></i>
                                <span>Settings</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Logout Section -->
                <div class="nav-section logout-section">
                    <a href="{% url 'users:logout' %}" class="nav-link logout-link" data-tooltip="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-content">
            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery for Selectize (used in profile completion modal) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Base JS -->
    <script src="{% static 'users/js/base_minimal.js' %}"></script>
    <!-- Sidebar JS -->
    <script src="{% static 'users/js/sidebar.js' %}"></script>
    <!-- Toast JS -->
    <script src="{% static 'users/js/toast.js' %}"></script>
    <!-- Dashboard JS -->
    {% block dashboard_js %}{% endblock %}
    <!-- Profile JS -->
    {% block profile_js %}{% endblock %}

    {% block scripts %}{% endblock %}
    
    <!-- Dark Mode Initialization -->
    <script>
        // Initialize dark mode from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
        });
    </script>
</body>
</html>