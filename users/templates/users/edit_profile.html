{% extends 'core/base.html' %}
{% load static %}

{% block title %}Edit Profile - GameHub{% endblock %}

{% block dashboard_css %}
    <link rel="stylesheet" href="{% static 'users/css/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/edit_profile.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/settings.css' %}">
{% endblock %}

{% block content %}
<!-- Edit Profile Header -->
<section class="settings-header">
    <div class="settings-header-content">
        <div class="settings-header-title">
            <h1><i class="fas fa-user-edit"></i> Edit Profile</h1>
            <p>Update your profile information and gaming preferences</p>
        </div>
        <div class="settings-header-actions">
            <a href="{% url 'users:gamer_settings' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> Back to Settings
            </a>
        </div>
    </div>
</section>

<!-- Edit Profile Content -->
<div class="edit-profile-container">
    <div class="edit-profile-form">
        <form method="post" enctype="multipart/form-data" id="editProfileForm">
            {% csrf_token %}
            
            <!-- Read-only Personal Information Section -->
            <div class="form-section">
                <h3 class="section-title">Personal Information (Read-only)</h3>
                
                <div class="form-group">
                    <label for="id_first_name" class="readonly-label">First Name</label>
                    <input type="text" id="id_first_name" value="{{ user.first_name|default:'' }}" 
                           class="readonly-field" readonly>
                    <small class="form-text">First name cannot be changed</small>
                </div>
                
                <div class="form-group">
                    <label for="id_last_name" class="readonly-label">Last Name</label>
                    <input type="text" id="id_last_name" value="{{ user.last_name|default:'' }}" 
                           class="readonly-field" readonly>
                    <small class="form-text">Last name cannot be changed</small>
                </div>
                
                <div class="form-group">
                    <label for="id_email" class="readonly-label">Email Address</label>
                    <input type="email" id="id_email" value="{{ user.email|default:'' }}" 
                           class="readonly-field" readonly>
                    <small class="form-text">Email cannot be changed at this time</small>
                </div>
                
                <div class="form-group">
                    <label for="id_date_of_birth" class="readonly-label">Date of Birth</label>
                    <input type="date" id="id_date_of_birth" 
                           value="{{ user.date_of_birth|date:'Y-m-d'|default:'' }}" 
                           class="readonly-field" readonly>
                    <small class="form-text">Date of birth cannot be changed</small>
                </div>
        </div>
        
            <!-- Editable Profile Information Section -->
            <div class="form-section">
                <h3 class="section-title">Profile Information (Editable)</h3>
                
                <!-- Avatar Upload -->
                    <div class="form-group">
                    <label for="id_profile_picture">Avatar</label>
                    <div class="avatar-upload">
                                <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'core/images/player.jpeg' %}{% endif %}" 
                             alt="Current Avatar" class="current-avatar" id="currentProfilePic">
                        <div>
                            <input type="file" name="profile_picture" id="id_profile_picture" accept="image/*">
                            <label for="id_profile_picture" class="avatar-upload-label">
                                <i class="fas fa-camera"></i>
                                <span>Change Avatar</span>
                            </label>
                        </div>
                    </div>
                    <small class="form-text">Upload a new profile picture (JPG, PNG, GIF up to 5MB)</small>
                </div>

                <!-- Username -->
                    <div class="form-group">
                    <label for="id_custom_username">Custom Username <span class="required">*</span></label>
                    <div class="username-input-group">
                        <input type="text" name="custom_username" id="id_custom_username" 
                               value="{{ profile_form.custom_username.value|default:'' }}" 
                               placeholder="Enter your username" required>
                        <button type="button" id="generateUsernameBtn" class="generate-btn">
                            <i class="fas fa-dice"></i>
                        </button>
                    </div>
                    <div id="custom_username-error" class="error-message"></div>
                    <small class="form-text">3-20 characters, letters, numbers, and underscores only</small>
                    </div>
                
                <!-- Bio -->
                    <div class="form-group">
                    <label for="id_bio">Bio <span class="required">*</span></label>
                        <input type="text" name="bio" id="id_bio" 
                           value="{{ profile_form.bio.value|default:'' }}" 
                           placeholder="Tell us about yourself in one line" required>
                    <div id="bio-error" class="error-message"></div>
                    <small class="form-text">10-160 characters, single line</small>
                </div>

                <!-- About -->
                    <div class="form-group">
                    <label for="id_about">About <small class="text-muted">(optional)</small></label>
                    <textarea name="about" id="id_about" rows="4" 
                              placeholder="Tell us more about yourself, your gaming experience, and what you're looking for in the community">{{ profile_form.about.value|default:'' }}</textarea>
                    <div class="char-counter">
                        <span id="aboutCounter">0</span>/500
                    </div>
                    <small class="form-text">30-500 characters, supports emojis and line breaks</small>
                    </div>
                </div>

            <!-- Gaming Preferences Section -->
            <div class="form-section">
                <h3 class="section-title">Gaming Preferences (Editable)</h3>
                
                <!-- Platforms -->
                <div class="form-group">
                    <label>Gaming Platforms <span class="required">*</span></label>
                    <div class="platforms-container" id="platformsTags"></div>
                    <input type="hidden" name="platforms" id="id_platforms" value="{{ profile_form.platforms.value|default:'[]' }}">
                    <div id="platforms-error" class="error-message"></div>
                    <small class="form-text">Select the platforms you game on</small>
                </div>

                <!-- Games -->
                <div class="form-group">
                    <label>Favorite Games <span class="required">*</span></label>
                    <div class="games-container" id="gamesTags"></div>
                    <div class="game-input-container">
                        <input type="text" id="gameInput" placeholder="Add a game..." class="game-input">
                        <small class="form-text">Type and press Enter to add custom games</small>
                    </div>
                    <input type="hidden" name="games" id="id_games" value="{{ profile_form.games.value|default:'[]' }}">
                    <div id="games-error" class="error-message"></div>
                    <small class="form-text">Select your favorite games or add custom ones</small>
                    </div>
                </div>

            <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                <a href="{% url 'users:gamer_settings' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
                </div>
            </form>
    </div>
</div>
{% endblock %}

{% block dashboard_js %}
    <script src="{% static 'users/js/edit_profile.js' %}"></script>
{% endblock %}