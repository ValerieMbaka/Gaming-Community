{% extends 'core/base_minimal.html' %}
{% load static %}

{% block title %} Edit Profile | GameHub {% endblock %}

{% block dashboard_css %}
    <link rel="stylesheet" href="{% static 'users/css/dashboard.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/edit_profile.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/settings.css' %}">
{% endblock %}

{% block content %}
<!-- Edit Profile Header -->
<section class="settings-header">
    <div class="settings-header-content">
        <div class="settings-header-info">
            <h1><i class="fas fa-user-edit"></i> Edit Profile</h1>
            <p>Update your profile information and gaming preferences</p>
        </div>
        <div class="settings-header-actions">
            <a href="{% url 'users:gamer_settings' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> Back to Settings
            </a>
        </div>
    </div>
</section>

<!-- Edit Profile Content -->
<div class="settings-content">
    <div class="settings-section">
        <div class="settings-section-header">
            <h2><i class="fas fa-user-edit"></i> Edit Profile</h2>
            <p>Update your profile information and gaming preferences</p>
                </div>
                
        <div class="settings-section-body">
            <form method="post" enctype="multipart/form-data" class="settings-form" id="editProfileForm">
                {% csrf_token %}
                <input type="hidden" name="action" value="update_profile">
                
                <!-- Personal Information Section -->
            <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-user"></i> Personal Information</h3>
                
                    <!-- Profile Picture -->
                    <div class="form-group">
                        <label for="id_profile_picture">Profile Picture</label>
                        <div class="profile-picture-upload">
                            <div class="current-picture">
                                <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'core/images/player.jpeg' %}{% endif %}" 
                                     alt="Current Profile Picture" id="currentProfilePic">
                            </div>
                            <input type="file" name="profile_picture" id="id_profile_picture" accept="image/*">
                            <label for="id_profile_picture" class="upload-btn">
                                <i class="fas fa-camera"></i> Change Picture
                            </label>
                        </div>
                </div>

                <!-- Username -->
                    <div class="form-group">
                        <label for="id_custom_username">Username <span class="required">*</span></label>
                    <div class="username-input-group">
                        <input type="text" name="custom_username" id="id_custom_username" 
                                   value="{{ profile_form.custom_username.value|default_if_none:'' }}" 
                               placeholder="Enter your username" required>
                        <button type="button" id="generateUsernameBtn" class="generate-btn">
                            <i class="fas fa-dice"></i>
                                <span>Generate</span>
                        </button>
                    </div>
                    <div id="custom_username-error" class="error-message"></div>
                        <small>This is your unique username on GameHub (3-20 characters)</small>
                    </div>
                
                    <!-- Bio and Location Row -->
                    <div class="form-row">
                    <div class="form-group">
                    <label for="id_bio">Bio <span class="required">*</span></label>
                        <input type="text" name="bio" id="id_bio" 
                                   value="{{ profile_form.bio.value|default_if_none:'' }}" 
                           placeholder="Tell us about yourself in one line" required>
                    <div id="bio-error" class="error-message"></div>
                            <small>A short description about yourself (10-160 characters)</small>
                        </div>
                        <div class="form-group">
                            <label for="id_location">Location <span class="required">*</span></label>
                            <input type="text" name="location" id="id_location" 
                                   value="{{ profile_form.location.value|default_if_none:'' }}" 
                                   placeholder="Your location" required>
                            <small>Where are you located?</small>
                        </div>
                </div>

                <!-- About -->
                    <div class="form-group">
                    <label for="id_about">About <small class="text-muted">(optional)</small></label>
                    <textarea name="about" id="id_about" rows="4" 
                                  placeholder="Tell us more about yourself, your gaming experience, and what you're looking for in the community">{{ profile_form.about.value|default_if_none:'' }}</textarea>
                    <div class="char-counter">
                        <span id="aboutCounter">0</span>/500
                    </div>
                        <small>Tell us more about yourself (30-500 characters)</small>
                    </div>
                </div>

            <!-- Gaming Preferences Section -->
            <div class="form-section">
                    <h3 class="section-title"><i class="fas fa-gamepad"></i> Gaming Preferences</h3>
                
                <!-- Platforms -->
                <div class="form-group">
                    <label>Gaming Platforms <span class="required">*</span></label>
                        <div class="platforms-grid">
                            <label class="platform-checkbox">
                                <input type="checkbox" name="platforms" value="pc" 
                                       {% if 'pc' in user.platforms %}checked{% endif %}>
                                <span class="platform-label">PC</span>
                            </label>
                            <label class="platform-checkbox">
                                <input type="checkbox" name="platforms" value="playstation" 
                                       {% if 'playstation' in user.platforms %}checked{% endif %}>
                                <span class="platform-label">PlayStation</span>
                            </label>
                            <label class="platform-checkbox">
                                <input type="checkbox" name="platforms" value="xbox" 
                                       {% if 'xbox' in user.platforms %}checked{% endif %}>
                                <span class="platform-label">Xbox</span>
                            </label>
                            <label class="platform-checkbox">
                                <input type="checkbox" name="platforms" value="nintendo" 
                                       {% if 'nintendo' in user.platforms %}checked{% endif %}>
                                <span class="platform-label">Nintendo Switch</span>
                            </label>
                            <label class="platform-checkbox">
                                <input type="checkbox" name="platforms" value="mobile" 
                                       {% if 'mobile' in user.platforms %}checked{% endif %}>
                                <span class="platform-label">Mobile</span>
                            </label>
                        </div>
                </div>

                <!-- Games -->
                <div class="form-group">
                        <label for="games_input">Games <span class="required">*</span></label>
                        <div class="games-input-container">
                            <input type="text" id="games_input" placeholder="Type a game and press Enter">
                            <div class="selected-games" id="selectedGames">
                                {% for game in user.games %}
                                    <span class="game-tag">{{ game }} <i class="fas fa-times remove-game" data-game="{{ game }}"></i></span>
                                {% endfor %}
                            </div>
                    </div>
                        <input type="hidden" name="games" id="id_games" value="{{ user.games|join:',' }}">
                    </div>
                </div>

            <!-- Form Actions -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                <a href="{% url 'users:gamer_settings' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block dashboard_js %}
    <script src="{% static 'users/js/edit_profile.js' %}"></script>
{% endblock %}